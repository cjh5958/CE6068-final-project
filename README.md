# ğŸ§¬ ç™½è¡€ç—…åŸºå› è¡¨é”è³‡æ–™å¢å¼·å°ˆæ¡ˆ (Leukemia Gene Expression Data Augmentation)

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°

æœ¬å°ˆæ¡ˆæä¾›å®Œæ•´çš„æ¢ä»¶è®Šåˆ†è‡ªç·¨ç¢¼å™¨ (Conditional VAE, cVAE) è§£æ±ºæ–¹æ¡ˆï¼Œç”¨æ–¼ç™½è¡€ç—…åŸºå› è¡¨é”è³‡æ–™çš„è¨“ç·´å’Œç”Ÿæˆã€‚æ”¯æ´å¾é›¶é–‹å§‹è¨“ç·´æ¨¡å‹ï¼Œä»¥åŠä½¿ç”¨é è¨“ç·´æ¨¡å‹ç”Ÿæˆé«˜å“è³ªåˆæˆè³‡æ–™ã€‚

### ğŸ¯ ä¸»è¦åŠŸèƒ½
- **æ¨¡å‹è¨“ç·´**: å®Œæ•´çš„ cVAE è¨“ç·´æµç¨‹ï¼Œæ”¯æ´è‡ªè¨‚åƒæ•¸
- **è³‡æ–™ç”Ÿæˆ**: ä½¿ç”¨é è¨“ç·´æ¨¡å‹ç”Ÿæˆåˆæˆè³‡æ–™
- **å¤šé¡å‹æ”¯æ´**: æ”¯æ´ 5 ç¨®ç™½è¡€ç—…é¡å‹çš„è³‡æ–™ç”Ÿæˆ
- **æ ¼å¼å…¼å®¹**: ç”Ÿæˆè³‡æ–™å®Œå…¨åŒ¹é…åŸå§‹è³‡æ–™æ ¼å¼ï¼Œä¾¿æ–¼ä¸‹æ¸¸ä½¿ç”¨
- **éˆæ´»è¼¸å‡º**: æ”¯æ´ CSV å’Œ PKL æ ¼å¼

### ğŸ§ª æ”¯æ´çš„ç™½è¡€ç—…é¡å‹
1. **AML** - æ€¥æ€§éª¨é«“æ€§ç™½è¡€ç—…
2. **Bone_Marrow** - éª¨é«“æ¨£æœ¬
3. **Bone_Marrow_CD34** - CD34+ éª¨é«“ç´°èƒ
4. **PB** - å‘¨é‚Šè¡€æ¶²
5. **PBSC_CD34** - CD34+ å‘¨é‚Šè¡€æ¶²å¹¹ç´°èƒ

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
CE6068-final-project/
â”œâ”€â”€ README.md                    # æœ¬æª”æ¡ˆ
â”œâ”€â”€ train_model.py               # æ¨¡å‹è¨“ç·´è…³æœ¬
â”œâ”€â”€ generate_data.py             # è³‡æ–™ç”Ÿæˆè…³æœ¬
â”œâ”€â”€ model_usage_guide.py         # Python API ä»‹é¢
â”œâ”€â”€ models/                      # è¨“ç·´å¥½çš„æ¨¡å‹
â”‚   â””â”€â”€ leukemia_cvae_model.pth  # cVAE æ¨¡å‹æª”æ¡ˆ (1.1GB)
â”œâ”€â”€ datasets/                    # è³‡æ–™æª”æ¡ˆ
â”‚   â”œâ”€â”€ raw_data.csv            # åŸå§‹è³‡æ–™é›†
â”‚   â”œâ”€â”€ scaler.pkl              # ç‰¹å¾µæ­£è¦åŒ–å™¨
â”‚   â”œâ”€â”€ label_encoder.pkl       # æ¨™ç±¤ç·¨ç¢¼å™¨
â”‚   â”œâ”€â”€ metadata.pkl            # è³‡æ–™å…ƒè³‡è¨Š (å«åŸºå› åç¨±)
â”‚   â””â”€â”€ [ç”Ÿæˆçš„è³‡æ–™å°‡ä¿å­˜åœ¨æ­¤]
â”œâ”€â”€ training_logs/              # è¨“ç·´æ—¥èªŒ (è¨“ç·´å¾Œç”¢ç”Ÿ)
â””â”€â”€ [æ ¸å¿ƒç¨‹å¼ç¢¼æª”æ¡ˆ]
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### **ç’°å¢ƒè¨­ç½®**
```bash
# å»ºç«‹ä¸¦å•Ÿå‹•è™›æ“¬ç’°å¢ƒ (å»ºè­°)
python -m venv venv
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate

# å®‰è£ä¾è³´
pip install torch torchvision pandas numpy scikit-learn matplotlib seaborn
```

### **æ–¹å¼ 1: æ¨¡å‹è¨“ç·´ (å¾é›¶é–‹å§‹)**

```bash
# åŸºæœ¬è¨“ç·´ (ä½¿ç”¨é è¨­åƒæ•¸)
python train_model.py

# è‡ªè¨‚è¨“ç·´åƒæ•¸
python train_model.py --epochs 150 --batch-size 16 --learning-rate 5e-5

# ä½¿ç”¨GPUè¨“ç·´ (å¦‚æœå¯ç”¨)
python train_model.py --device cuda

# ä½¿ç”¨é…ç½®æª”æ¡ˆ
python train_model.py --config my_config.json
```

### **æ–¹å¼ 2: è³‡æ–™ç”Ÿæˆ (ä½¿ç”¨é è¨“ç·´æ¨¡å‹)**

```bash
# ç”Ÿæˆå¹³è¡¡è³‡æ–™é›† (æ¨è–¦)
python generate_data.py --balanced --samples-per-class 50

# ç”Ÿæˆç‰¹å®šé¡å‹æ¨£æœ¬
python generate_data.py --type AML --samples 100

# è‡ªè¨‚è¼¸å‡ºæ ¼å¼å’Œæª”å
python generate_data.py --type PB --samples 200 --format csv --output my_pb_data
```

### **æ–¹å¼ 3: Python API**

```python
from model_usage_guide import LeukemiaCVAEGenerator

# åˆå§‹åŒ–ç”Ÿæˆå™¨
generator = LeukemiaCVAEGenerator()

# ç”Ÿæˆç‰¹å®šé¡å‹æ¨£æœ¬
aml_data = generator.quick_generate_and_save(
    leukemia_type='AML', 
    n_samples=100,
    save_format='both'
)

# ç”Ÿæˆå¹³è¡¡è³‡æ–™é›†
balanced_data = generator.quick_generate_balanced_and_save(
    samples_per_class=50,
    save_format='both'
)
```

## ğŸ“Š è¼¸å‡ºæ ¼å¼

### **CSV æ ¼å¼ (å®Œå…¨åŒ¹é…åŸå§‹è³‡æ–™)**
ç”Ÿæˆçš„è³‡æ–™å°‡å®Œå…¨åŒ¹é…åŸå§‹è¼¸å…¥æ ¼å¼ï¼ŒåŒ…æ‹¬ï¼š
```csv
samples,type,1007_s_at,1053_at,117_at,121_at,1255_g_at,1294_at,1316_at,1320_at,...
1000,AML,7.234,8.456,6.123,9.789,4.567,7.890,8.234,7.567,...
1001,AML,7.456,8.234,6.345,9.456,4.789,7.567,8.456,7.789,...
1002,Bone_Marrow,6.789,7.123,5.890,8.234,4.123,6.789,7.123,6.456,...
...
```

### **ç‰¹é»**
- âœ… **samplesæ¬„ä½**: è‡ªå‹•ç”Ÿæˆæ¨£æœ¬ID (å¾1000é–‹å§‹)
- âœ… **typeæ¬„ä½**: ä½¿ç”¨åŸå§‹ç™½è¡€ç—…é¡å‹åç¨±
- âœ… **åŸºå› æ¬„ä½**: ä½¿ç”¨çœŸå¯¦åŸºå› ID (å¦‚ 1007_s_at, 1053_at...)
- âœ… **æ¬„ä½é †åº**: å®Œå…¨åŒ¹é…åŸå§‹è³‡æ–™æ¬„ä½é †åº
- âœ… **ç›´æ¥ä½¿ç”¨**: å¯ç›´æ¥ç”¨æ–¼ä¸‹æ¸¸åˆ†æï¼Œç„¡éœ€é¡å¤–è™•ç†

### **æª”æ¡ˆå‘½åè¦å‰‡**
```
datasets/
â”œâ”€â”€ balanced_leukemia_dataset_20250601_143022.csv
â”œâ”€â”€ balanced_leukemia_dataset_complete_20250601_143022.pkl
â”œâ”€â”€ aml_samples_20250601_143530.csv
â””â”€â”€ aml_samples_complete_20250601_143530.pkl
```

### **PKL æ ¼å¼**
```python
{
    'features': numpy.ndarray,      # åŸºå› è¡¨é”ç‰¹å¾µ (n_samples, 22283)
    'labels': numpy.ndarray,        # æ•¸å€¼æ¨™ç±¤ 
    'class_names': list,            # é¡åˆ¥åç¨±
    'generation_time': str,         # ç”Ÿæˆæ™‚é–“
    'metadata': {
        'gene_names': list,         # çœŸå¯¦åŸºå› åç¨±
        'total_genes': int,         # åŸºå› ç¸½æ•¸
        'available_classes': list   # å¯ç”¨é¡åˆ¥
    }
}
```

## âš™ï¸ ç³»çµ±éœ€æ±‚

### **è»Ÿé«”éœ€æ±‚**
- Python 3.8+
- PyTorch 2.0+
- å…¶ä»–ä¾è³´: pandas, numpy, scikit-learn

### **ç¡¬é«”éœ€æ±‚**
- **CPU**: ç¾ä»£å¤šæ ¸å¿ƒè™•ç†å™¨
- **RAM**: å»ºè­° 8GB ä»¥ä¸Š (è¨“ç·´æ™‚éœ€è¦ 16GB+)
- **å„²å­˜ç©ºé–“**: 5GB å¯ç”¨ç©ºé–“
- **GPU**: å¯é¸ï¼ŒCUDA æ”¯æ´çš„é¡¯å¡å¯å¤§å¹…åŠ é€Ÿè¨“ç·´

## ğŸ”§ æ•…éšœæ’é™¤

### **è¨“ç·´å•é¡Œ**

#### ğŸ”´ è¨˜æ†¶é«”ä¸è¶³
```bash
# æ¸›å°‘æ‰¹æ¬¡å¤§å°
python train_model.py --batch-size 4

# ä½¿ç”¨è¼ƒå°çš„æ¨¡å‹
python train_model.py --latent-dim 128
```

#### ğŸ”´ è¨“ç·´éæ…¢
```bash
# ä½¿ç”¨GPU (å¦‚æœå¯ç”¨)
python train_model.py --device cuda

# æ¸›å°‘è¨“ç·´é€±æœŸ
python train_model.py --epochs 50
```

### **ç”Ÿæˆå•é¡Œ**

#### ğŸ”´ æ¨¡å‹æª”æ¡ˆéºå¤±
```bash
# å…ˆè¨“ç·´æ¨¡å‹
python train_model.py

# ç„¶å¾Œç”Ÿæˆè³‡æ–™
python generate_data.py --balanced
```

#### ğŸ”´ ç”Ÿæˆå¤±æ•—
ç¢ºä¿ä»¥ä¸‹æª”æ¡ˆå­˜åœ¨ï¼š
- `models/leukemia_cvae_model.pth`
- `datasets/scaler.pkl`
- `datasets/metadata.pkl` (å«åŸºå› åç¨±)

### **ç’°å¢ƒå•é¡Œ**

#### ğŸ”´ ä¾è³´å¥—ä»¶å•é¡Œ
```bash
# å®‰è£å®Œæ•´ä¾è³´
pip install torch pandas numpy scikit-learn matplotlib seaborn

# æˆ–ä½¿ç”¨conda
conda install pytorch pandas numpy scikit-learn matplotlib seaborn
```

## ğŸ“ˆ ä½¿ç”¨æµç¨‹å»ºè­°

### **æ–°ç”¨æˆ¶ (å¾é›¶é–‹å§‹)**
1. **æº–å‚™ç’°å¢ƒ**: å»ºç«‹è™›æ“¬ç’°å¢ƒä¸¦å®‰è£ä¾è³´
2. **æº–å‚™è³‡æ–™**: ç¢ºä¿ `datasets/raw_data.csv` å­˜åœ¨
3. **è¨“ç·´æ¨¡å‹**: `python train_model.py`
4. **ç”Ÿæˆè³‡æ–™**: `python generate_data.py --balanced`
5. **é©—è­‰æ ¼å¼**: æª¢æŸ¥ç”Ÿæˆè³‡æ–™æ ¼å¼æ˜¯å¦åŒ¹é…åŸå§‹è³‡æ–™

### **ç¾æœ‰æ¨¡å‹ç”¨æˆ¶**
1. **æª¢æŸ¥æ¨¡å‹**: ç¢ºä¿æ¨¡å‹å’Œmetadataæª”æ¡ˆå­˜åœ¨
2. **ç›´æ¥ç”Ÿæˆ**: `python generate_data.py --type AML --samples 100`
3. **ä¸‹æ¸¸ä½¿ç”¨**: ç”Ÿæˆçš„è³‡æ–™å¯ç›´æ¥ç”¨æ–¼æ©Ÿå™¨å­¸ç¿’æ¨¡å‹

### **å”ä½œé–‹ç™¼**
1. **ç’°å¢ƒéš”é›¢**: æ¯å€‹é–‹ç™¼è€…å»ºç«‹è‡ªå·±çš„è™›æ“¬ç’°å¢ƒ
2. **ç‰ˆæœ¬æ§åˆ¶**: åƒ…è¿½è¹¤ç¨‹å¼ç¢¼ï¼Œä¸åŒ…å«æ¨¡å‹æª”æ¡ˆå’Œè™›æ“¬ç’°å¢ƒ
3. **è³‡æ–™æ¨™æº–**: çµ±ä¸€ä½¿ç”¨åŸå§‹è³‡æ–™æ ¼å¼é€²è¡Œäº¤æ›

## ğŸ“š æŠ€è¡“ç´°ç¯€

### **æ¨¡å‹æ¶æ§‹**
- **é¡å‹**: æ¢ä»¶è®Šåˆ†è‡ªç·¨ç¢¼å™¨ (Conditional VAE)
- **æ½›åœ¨ç©ºé–“ç¶­åº¦**: 256 (å¯èª¿æ•´)
- **ç·¨ç¢¼å™¨**: [2048, 1024, 512, 256] éš±è—å±¤
- **è§£ç¢¼å™¨**: [256, 512, 1024, 2048] éš±è—å±¤
- **æ¢ä»¶ç¶­åº¦**: 5 (å°æ‡‰ 5 ç¨®ç™½è¡€ç—…é¡å‹)

### **è¨“ç·´è³‡æ–™**
- **åŸå§‹æ¨£æœ¬**: 64 å€‹æ¨£æœ¬ Ã— 22,283 å€‹åŸºå› 
- **è³‡æ–™ä¾†æº**: Kaggle ç™½è¡€ç—…åŸºå› è¡¨é”è³‡æ–™é›†
- **å‰è™•ç†**: æ¨™æº–åŒ– + æ¨™ç±¤ç·¨ç¢¼
- **è³‡æ–™åˆ†å‰²**: è¨“ç·´/é©—è­‰/æ¸¬è©¦ = 73%/12%/15%

### **æ ¼å¼å…¼å®¹æ€§**
- **å®Œå…¨åŒ¹é…**: ç”Ÿæˆè³‡æ–™èˆ‡åŸå§‹è³‡æ–™æ ¼å¼100%ç›¸åŒ
- **åŸºå› åç¨±**: ä¿ç•™çœŸå¯¦åŸºå› æ¢é‡ID (å¦‚ 1007_s_at)
- **æ¨£æœ¬ç·¨è™Ÿ**: è‡ªå‹•ç”Ÿæˆä¸è¡çªçš„æ¨£æœ¬ID
- **å³ç”¨æ€§**: ç„¡éœ€é¡å¤–è™•ç†å³å¯ç”¨æ–¼ä¸‹æ¸¸åˆ†æ

## ğŸ“ æ”¯æ´èˆ‡é€²éšä½¿ç”¨

### **å‘½ä»¤åˆ—åƒæ•¸å®Œæ•´åˆ—è¡¨**

#### **è¨“ç·´è…³æœ¬ (train_model.py)**
```bash
--config          # é…ç½®æª”æ¡ˆè·¯å¾‘
--epochs          # è¨“ç·´é€±æœŸæ•¸ (é è¨­: 100)
--batch-size      # æ‰¹æ¬¡å¤§å° (é è¨­: 8)
--learning-rate   # å­¸ç¿’ç‡ (é è¨­: 1e-4)
--latent-dim      # æ½›åœ¨ç©ºé–“ç¶­åº¦ (é è¨­: 256)
--device          # é‹ç®—è£ç½® (é è¨­: auto)
```

#### **ç”Ÿæˆè…³æœ¬ (generate_data.py)**
```bash
--type               # ç™½è¡€ç—…é¡å‹
--balanced           # ç”Ÿæˆå¹³è¡¡è³‡æ–™é›†
--samples            # æ¨£æœ¬æ•¸é‡ (å–®ä¸€é¡å‹)
--samples-per-class  # æ¯é¡æ¨£æœ¬æ•¸ (å¹³è¡¡è³‡æ–™é›†)
--format             # è¼¸å‡ºæ ¼å¼ (csv/pkl/both)
--output             # è‡ªè¨‚æª”åå‰ç¶´
--output-dir         # è¼¸å‡ºç›®éŒ„
```

### **Python API é€²éšåŠŸèƒ½**
```python
# æª¢æŸ¥æ ¼å¼å…¼å®¹æ€§
generator = LeukemiaCVAEGenerator()
print(f"Gene names loaded: {len(generator.gene_names)}")
print(f"First 5 genes: {generator.gene_names[:5]}")

# æ‰¹æ¬¡ç”Ÿæˆå¤šç¨®é¡å‹
for leukemia_type in ['AML', 'PB', 'Bone_Marrow']:
    data = generator.generate_samples(leukemia_type, n_samples=50)
    # è³‡æ–™æ ¼å¼èˆ‡åŸå§‹è³‡æ–™å®Œå…¨ç›¸åŒ
```